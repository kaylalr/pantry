<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Pantry</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- Plugin CSS -->
  <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css">

  <!-- Custom styles for this template -->
  <link href="css/freelancer.min.css" rel="stylesheet">

  <!-- Link to my style sheet -->
  <link href="mycss/main.css" rel="stylesheet">



</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">Pantry</a>
      <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button"
        data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
        aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">

          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/food">Food</a>
          </li>
          <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/addFood">Add Food</a>
          </li>



        </ul>
      </div>
    </div>
  </nav>



  <!-- Add Food -->
  <section class="addFood padding-top" id="addFood">
    <div class="container">
      <h2 class="text-center text-uppercase text-secondary mb-0">My Food</h2>
      <hr class="star-dark mb-5">

      <!-- *************** ADD CONTENT HERE ***************-->

      <div class="container food-content">
        <% foods.forEach(function(food) { %>
        <div class="row">
          <div class="col-8 col-sm-12 flex-row">
            <div class="food-name-expiration">
              <h4 class="no-link">
                <%= food.food_name %>
              </h4>
              <h4 class="link"><a href="/edit/<%= food.food_id%>">
                <%= food.food_name %>
              </h4></a>
              <p>
                <%= food.expiration %>
              </p>
            </div>
            <div class="quantity">
              <div>
                <h5 id="<%= food.food_id%>-quantity">
                  <%= food.quantity_num %>
                </h5>
                <p>
                  <%= food.quantity_type_name %>
                </p>
              </div>
              <div>
                <button onclick="setFood('<%= food.food_id%>', '<%= food.quantity_num %>')" class="btn btn-primary add-food">+</button>
                <button onclick="setFood('<%= food.food_id%>', '<%= food.quantity_num %>')" class="btn btn-danger subtract-food">-</button>
              </div>
            </div>
          </div>
          <!-- this is to force the columns to wrap on a small screen -->
          <div class="width-100"></div>
          <div class="col-4 food-buttons hide-small">
            <div>
              <a href="/edit/<%= food.food_id%>"><button type="button" class="btn btn-secondary">Edit</button></a>
              <a href="#"><button type="button" onclick="setInfo('<%= food.food_id %>')" class="btn btn-danger delete-button">Delete</button></a>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </section>

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="padding:35px 50px;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <!-- <h4><span class="glyphicon glyphicon-lock"></span> Login</h4> -->
        </div>
        <div class="modal-body" style="padding:40px 50px;">
          <h3>Are you sure you want to delete this item?</h3>
        </div>
        <div class="modal-footer">
          <button id="yes-delete" class="btn btn-success">Yes</button>
          <button class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>
            Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Location</h4>
          <p class="lead mb-0">2215 John Daniel Drive
            <br>Clark, MO 65243</p>
        </div>
        <div class="col-md-4 mb-5 mb-lg-0">
          <h4 class="text-uppercase mb-4">Around the Web</h4>
          <ul class="list-inline mb-0">
            <li class="list-inline-item">
              <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                <i class="fab fa-fw fa-facebook-f"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                <i class="fab fa-fw fa-google-plus-g"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                <i class="fab fa-fw fa-twitter"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                <i class="fab fa-fw fa-linkedin-in"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn btn-outline-light btn-social text-center rounded-circle" href="#">
                <i class="fab fa-fw fa-dribbble"></i>
              </a>
            </li>
          </ul>
        </div>
        <div class="col-md-4">
          <h4 class="text-uppercase mb-4">About Freelancer</h4>
          <p class="lead mb-0">Freelance is a free to use, open source Bootstrap theme created by
            <a href="http://startbootstrap.com">Start Bootstrap</a>.</p>
        </div>
      </div>
    </div>
  </footer>

  <div class="copyright py-4 text-center text-white">
    <div class="container">
      <small>Copyright &copy; Your Website 2019</small>
    </div>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

  <!-- Contact Form JavaScript -->
  <script src="js/jqBootstrapValidation.js"></script>
  <script src="js/contact_me.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/freelancer.min.js"></script>

  <script>
    var foodId;
    var foodAddSub;
    var currentQuantity;
    var timer;

    function setInfo(id) {
      foodId = id;
      console.log("set foodId: " + foodId)
    }

    function setFood(id, quantity) {
      foodAddSub = id;
      newId = id + "-quantity";
      currentQuantity = +document.getElementById(newId).innerHTML;

    }
    $(document).ready(function () {
      $(".delete-button").click(function () {
        $("#myModal").modal();
      });
      $("#yes-delete").click(function () {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            $("#myModal").modal("hide");
          }
        };
        xhttp.open("DELETE", "/delete/" + foodId, true);
        xhttp.send();

      })
      $(".add-food").click(function () {
        id = foodAddSub + "-quantity";
        currentQuantity = +currentQuantity + 1;
        document.getElementById(id).innerHTML = currentQuantity;
        if (typeof timer != 'undefined') {
          clearTimeout(timer);
        }
        timer = setTimeout(updateDatabase, 500);
      });
      $(".subtract-food").click(function () {
        if (currentQuantity == 1) {
          $("#myModal").modal();
        } else {
          id = foodAddSub + "-quantity";
          currentQuantity = +currentQuantity - 1;
          document.getElementById(id).innerHTML = currentQuantity;
          if (typeof timer != 'undefined') {
            clearTimeout(timer);
          }
          timer = setTimeout(updateDatabase, 500);
        }
      });
    });

    let width = $(window).width();
    if (width < 756) {
      // var $data = $(".row").wrap('<a href="#"></a>');
      // let foodIds = [];
      // foods.forEach(food => {
      //   foodIds.push(food.food_id);
      // })
      // i = -1;
      // $(".begin-row").before("<a href='/edit/" + foodIds[i++] + "'>");
      // $(".end-row").after("</a>");
      // console.log("test");

      let noLink = document.getElementsByClassName("no-link")
      let Link = document.getElementsByClassName("link")

      for(let i = 0; i < noLink.length; i++) {
        noLink[i].classList.add("hide-small");
        Link[i].classList.add("show-small");
      }
    }

    function updateDatabase() {
      var xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/food/" + foodAddSub + "/" + currentQuantity, true);
      xhttp.send();
    }
  </script>

</body>

</html>